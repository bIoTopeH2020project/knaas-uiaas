version: '3'
services:
    o-mi-node:
      build: o-mi-node/
      ports:
       - "8080:8080"

    mongodb:
      ports:
        - "27017:27017"
      image: mongo
      volumes:
        - './data/db:/data/db'
#      volumes_from:
#        - mongodata
#      command: -smallfiles --rest --auth

    node-red:
      build: node-red/
      ports:
        - "1880:1880"
      volumes:
        - "./modules:/usr/src/node-red/modules"
      links:
        - mongodb
        - o-mi-node

  heatwavemitigation:
      container_name: heatwavemitigation
      build: node-red/
      ports:
        - "1883:1880"
      volumes:
        - "./modules:/usr/src/node-red/modules"
      links:
        - mongodb
        - o-mi-node

  bottlebankcitizen:
      container_name: bottlebankcitizen
      build: node-red/
      ports:
        - "1884:1880"
      volumes:
        - "./modules:/usr/src/node-red/modules"
      links:
        - mongodb
        - o-mi-node

  bottlebankwastemanagement:
      container_name: bottlebankwastemanagement
      build: node-red/
      ports:
        - "1885:1880"
      volumes:
        - "./modules:/usr/src/node-red/modules"
      links:
        - mongodb
        - o-mi-node

  proxy:
      container_name: proxy
      image: proxy
      build:
       context: ./proxy
      ports:
       - "80:80"
      depends_on:
       - "o-mi-node"
       - "mongodb"
       - "node-red"
       - "heatwavemitigation"
       - "bottlebankcitizen"
       - "bottlebankwastemanagement"
